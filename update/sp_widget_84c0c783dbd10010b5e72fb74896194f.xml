<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope,$rootScope) {
	/* widget controller */
	var c = this;
	$rootScope.$on('selectNote',function(event,data){
	//	console.log("received note ID "+$rootScope.noteID);
	//	console.log("received note ID Event & data objects "+JSON.stringify(data));
		c.server.get({
			action: "getNote",
			noteID : $rootScope.noteID
		}).

		then(function(r){
			c.data.title = r.data.note.title;
			c.data.note	= r.data.note.note;
			c.data.noteIDD	= r.data.note.sys_id;

		});
	});
	
	c.modified = function(col){
//		alert("Clickd on Notes HTML field "+col);
		
		c.server.get({
			action: "updateNote",
			modtitle : c.data.title,
			modnote : c.data.note,
			noteID : c.data.noteIDD
		}).then (function(r){
			alert("Update note method updated record values in DB successfully");
			$rootScope.modsys_id = c.data.noteIDD;
			$rootScope.modtitle = c.data.title;
			$rootScope.modnote = c.data.note;
			//alert("Post update id is "+$rootScope.modsys_id);
			$rootScope.$emit('refreshNote', c.data.noteIDD);
		});
		
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>notes_body_new</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Notes Body New</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	/* populate the 'data' object */
	/* e.g., data.table = $sp.getValue('table'); */
	data.note = {};
	if(input && input.noteID)
	{
	//	gs.addInfoMessage("Input in Notes Body widget "+JSON.stringify(input));
		//	gs.addInfoMessage("sys id passed is "+input.noteID);

		var gr = new GlideRecord('x_snc_createnotes_note');
		gr.addQuery('sys_id='+input.noteID.toString());
		//	gr.orderByDesc('sys_created_on');
		gr.query()
		if(gr.next())
		{
			if(input.action == "getNote" ){
			//	gs.addInfoMessage("INSDIE GETNOTE");
				$sp.getRecordValues(data.note,gr,'title, note, sys_id')
			}
			else if(input.action == "updateNote" ){
			//	gs.addInfoMessage("INSDIE UPDATENOTE");
				gr.title = input.modtitle;
				gr.note = input.modnote;
				gr.update();
			}
		}
	}




})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-11-28 12:00:50</sys_created_on>
        <sys_id>84c0c783dbd10010b5e72fb74896194f</sys_id>
        <sys_mod_count>27</sys_mod_count>
        <sys_name>Notes Body New</sys_name>
        <sys_package display_value="CreateNotes" source="x_snc_createnotes">df5fd9a5090232007f44e1046c8ff69f</sys_package>
        <sys_policy/>
        <sys_scope display_value="CreateNotes">df5fd9a5090232007f44e1046c8ff69f</sys_scope>
        <sys_update_name>sp_widget_84c0c783dbd10010b5e72fb74896194f</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-11-29 09:57:30</sys_updated_on>
        <template><![CDATA[<div class="panel panel-default" ng-show="c.data.noteIDD">
  <div class="panel-heading clearfix">
    <div class="row">
      <div class="col-md-12">
        <input class="form-control" ng-change = "c.modified('title')" id="note-title" ng-model="c.data.title" />
      </div>
    </div>
  </div>
  <div class="panel-body">
    <textarea class="form-control" ng-change = "c.modified('body')" id="note-body" ng-model="c.data.note" ></textarea>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
